/*!
 * simple-basket - A simple javascript basket for values.
 * 
 * Copyright (c) 2015 JoÃ£o Carvalho (https://github.com/borntorun)
 * Licensed under MIT license
 *     See https://github.com/borntorun/simple-basket/blob/master/LICENSE
 * v0.5.0
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["_"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("lodash")):a.simplebasket=b(a._)}(this,function(a){"use strict";function b(a,b){var c=[].slice,d=c.call(arguments,2);return function(){return a.apply(b,d.concat(c.call(arguments)))}}function Basket(b){var c=[],f=b||{};this.add=function(){var a;a=1===arguments.length&&d(arguments[0])?[].slice.call(arguments[0]):[].slice.call(arguments);var b=f[i.UNIQUEKEY];return a.forEach(function(a){b&&"object"==typeof a&&h(a,b)&&this.find({key:b,value:a[b]}).length||c.push(a)},this),this},this.set=function(b){return d(b)!==!1?(this.add.apply(this,a.clone(b,!0)),this):void 0},this.getClone=function(){return a.clone(c,!0)},this.getAll=function(){return c},this.remove=function(a,b){for(var d=[],e=c.length,f=0;e>f;)c[f][a]&&c[f][a]===b?(d.push(c.splice(f,1)[0]),e--):f++;return d},this.removeAt=function(a){return a=0>a?c.length:a,c.splice(a,1)},this.removeAll=function(){return c.length=0,this},this.iterate=function(a){if(e(a))for(var b=c.length,d=0;b>d;d++)a.call(this,c[d],d,c)},this.count=function(){return c.length},this.find=function(a,b,d){function f(a,b,c){var d=a?a.valueOf():a,e=b?b.valueOf():b;d===e&&k.push(c)}function i(a){var b=g(a);return"[object String]"===b||"[object Number]"===b||"[object Boolean]"===b||"[object Date]"===b||"[object Object]"===b||"[object Undefined]"===b||"[object Null]"===b}function j(){var b,d=c.length,e="object"==typeof a&&!!a&&h(a,"key");if(b=e===!1?a:a.value,i(b))for(var g=0;d>g;g++){var j=c[g],k=c[g];e?j&&h(j,a.key)&&(k=j[a.key],f(k,b,j)):f(k,b,j)}}var k=[];return j(),b&&e(b)&&setTimeout(function(){b.call(d,k.length>0?null:new Error("not found"),k)}),k},this.getOptions=function(){return f}}function c(a){return"string"==typeof a&&/^[a-zA-Z0-9_$]+$/.test(a)}function BasePluginWrapper(a,b){return Object.defineProperty(this,"type",{value:c(a)?a:void 0}),Object.defineProperty(this,"directCall",{value:"undefined"==typeof b||"boolean"==typeof b?!!b:void 0}),void 0===this.type||void 0===this.directCall?{}:void 0}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}function e(a){return"[object Function]"==={}.toString.call(a)}var f=Function.prototype.call,g=b(f,{}.toString),h=b(f,{}.hasOwnProperty),i={UNIQUEKEY:"uniqueKey"},j=function(){},k={},l={};Basket.prototype.implement=function(a,b){function c(a){return function(){return a.apply(i,arguments)}}if(this instanceof Basket==!1)return!1;if(!k[a])return!1;if(!/^[a-zA-Z0-9_$]+$/.test(b.name))return!1;var d=a.toUpperCase();if(h(this,d))return!1;var f=l[a];for(var g in f){if(h(b,g)===!1)return!1;if(e(b[g])===!1)return!1}k[a].directCall===!1&&(h(Basket.prototype,a)||Object.defineProperty(Basket.prototype,a,{set:function(){},get:function(){return this[d]?b:void 0},configurable:!0}));var i=this,m={};for(g in f){var n=k[a].directCall?b[g]:f[g];Object.defineProperty(this,g,{value:c(n),configurable:!0}),m[g]=j}return Object.defineProperty(this,d,{value:m,configurable:!0}),!0},Basket.prototype.dispose=function(a){if(this instanceof Basket==!1)return!1;var b=a.toUpperCase();if(!h(this,b))return!1;var c=this[b];for(var d in c)h(this,d)&&delete this[d];return delete this[b],!0};var m={};return Object.defineProperty(m,"Basket",{set:function(){},get:function(){return Basket}}),m.create=function(a){var b;return a&&"[object Object]"===g(a)&&a[i.UNIQUEKEY]&&"string"==typeof a[i.UNIQUEKEY]&&(b={},b[i.UNIQUEKEY]=a[i.UNIQUEKEY]),new Basket(b)},m.plug=function(a){var b;if(!(a instanceof BasePluginWrapper))return!1;if(k[a.type])return!1;for(b in a)if(!h(a,b)||h(Basket.prototype,b))return!1;k[a.type]=a,l[a.type]={},Basket.prototype["I"+a.type.toUpperCase()]=a.type;for(b in a)h(a,b)&&e(a[b])&&(l[a.type][b]=a[b]);return!0},m.unplug=function(a,b){var c=a.type;return delete k[c],delete l[c],delete Basket.prototype["I"+c.toUpperCase()],b&&delete Basket.prototype[a.type],!0},m.getBasePluginWrapper=function(a){return new BasePluginWrapper(a,!1)},m.getBasePlugin=function(a){return new BasePluginWrapper(a,!0)},m});
