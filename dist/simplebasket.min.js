/*!
 * simple-basket - A simple javascript basket for values.
 * 
 * Copyright (c) 2015 JoÃ£o Carvalho (https://github.com/borntorun)
 * Licensed under MIT license
 *     See https://github.com/borntorun/simple-basket/blob/master/LICENSE
 * v0.4.0
 */
!function(global,factory){"use strict";"function"==typeof define&&define.amd?define(["_"],function(_){return factory(_)}):"object"==typeof exports?module.exports=factory(require("lodash")):global.simplebasket=factory(global._)}(this,function(_){"use strict";function _bind(fn,ctx){var _slice=[].slice,boundArgs=_slice.call(arguments,2);return function(){return fn.apply(ctx,boundArgs.concat(_slice.call(arguments)))}}function Basket(opt){var items=[],options=opt||{};this.add=function(){var _array;_array=1===arguments.length&&isArray(arguments[0])?[].slice.call(arguments[0]):[].slice.call(arguments);var uniqueKey=options[OPTIONS.UNIQUEKEY];return _array.forEach(function(item){uniqueKey&&"object"==typeof item&&_hasOwn(item,uniqueKey)&&this.find({key:uniqueKey,value:item[uniqueKey]}).length||items.push(item)},this),this},this.set=function(value){return isArray(value)!==!1?(this.add.apply(this,_.clone(value,!0)),this):void 0},this.getClone=function(){return _.clone(items,!0)},this.getAll=function(){return items},this.remove=function(key,value){for(var result=[],leng=items.length,i=0;leng>i;)items[i][key]&&items[i][key]===value?(result.push(items.splice(i,1)[0]),leng--):i++;return result},this.removeAt=function(index){return index=0>index?items.length:index,items.splice(index,1)},this.removeAll=function(){return items.length=0,this},this.iterate=function(callback){if(isFunction(callback))for(var leng=items.length,i=0;leng>i;i++)callback.call(this,items[i],i,items)},this.count=function(){return items.length},this.find=function(search,callback,thisArg){function _addIfequal(one,two,item){var first=one?one.valueOf():one,second=two?two.valueOf():two;first===second&&result.push(item)}function _isTypeOk(value){var oType=_toString(value);return"[object String]"===oType||"[object Number]"===oType||"[object Boolean]"===oType||"[object Date]"===oType||"[object Object]"===oType||"[object Undefined]"===oType||"[object Null]"===oType}function _search(){var value,leng=items.length,isKeyValueSearch="object"==typeof search&&!!search&&_hasOwn(search,"key");if(value=isKeyValueSearch===!1?search:search.value,_isTypeOk(value))for(var i=0;leng>i;i++){var it=items[i],valueIn=items[i];isKeyValueSearch?it&&_hasOwn(it,search.key)&&(valueIn=it[search.key],_addIfequal(valueIn,value,it)):_addIfequal(valueIn,value,it)}}var result=[];return _search(),callback&&isFunction(callback)&&setTimeout(function(){callback.call(thisArg,result.length>0?null:new Error("not found"),result)}),result},this.getOptions=function(){return options}}function validName(name){return"string"==typeof name&&/^[a-zA-Z0-9_$]+$/.test(name)}function BasePluginWrapper(type,directCall){return Object.defineProperty(this,"type",{value:validName(type)?type:void 0}),Object.defineProperty(this,"directCall",{value:"undefined"==typeof directCall||"boolean"==typeof directCall?!!directCall:void 0}),void 0===this.type||void 0===this.directCall?{}:void 0}function isArray(obj){return"[object Array]"===Object.prototype.toString.call(obj)}function isFunction(obj){return"[object Function]"==={}.toString.call(obj)}var __call__=Function.prototype.call,_toString=_bind(__call__,{}.toString),_hasOwn=_bind(__call__,{}.hasOwnProperty),OPTIONS={UNIQUEKEY:"uniqueKey"},noop=function(){},pluginWrapper={},pluginWrapperDefinition={};Basket.prototype.implement=function(wrapperName,driver){function fcaller(f){return function(){return f.apply(self,arguments)}}if(this instanceof Basket==!1)return!1;if(!pluginWrapper[wrapperName])return!1;if(!/^[a-zA-Z0-9_$]+$/.test(driver.name))return!1;var INAME=wrapperName.toUpperCase();if(_hasOwn(this,INAME))return!1;var Idefinition=pluginWrapperDefinition[wrapperName];for(var key in Idefinition){if(_hasOwn(driver,key)===!1)return!1;if(isFunction(driver[key])===!1)return!1}pluginWrapper[wrapperName].directCall===!1&&(_hasOwn(Basket.prototype,wrapperName)||Object.defineProperty(Basket.prototype,wrapperName,{set:function(){},get:function(){return this[INAME]?driver:void 0},configurable:!0}));var self=this,virtualDefiniton={};for(key in Idefinition){var f=pluginWrapper[wrapperName].directCall?driver[key]:Idefinition[key];Object.defineProperty(this,key,{value:fcaller(f),configurable:!0}),virtualDefiniton[key]=noop}return Object.defineProperty(this,INAME,{value:virtualDefiniton,configurable:!0}),!0},Basket.prototype.dispose=function(wrapperName){if(this instanceof Basket==!1)return!1;var INAME=wrapperName.toUpperCase();if(!_hasOwn(this,INAME))return!1;var Idefinition=this[INAME];for(var key in Idefinition)_hasOwn(this,key)&&delete this[key];return delete this[INAME],!0};var objExports={};return Object.defineProperty(objExports,"Basket",{set:function(){},get:function(){return Basket}}),objExports.create=function(options){var opt;return options&&"[object Object]"===_toString(options)&&options[OPTIONS.UNIQUEKEY]&&"string"==typeof options[OPTIONS.UNIQUEKEY]&&(opt={},opt[OPTIONS.UNIQUEKEY]=options[OPTIONS.UNIQUEKEY]),new Basket(opt)},objExports.plug=function(oBasePluginWrapper){var key;if(!(oBasePluginWrapper instanceof BasePluginWrapper))return!1;if(pluginWrapper[oBasePluginWrapper.type])return!1;for(key in oBasePluginWrapper)if(!_hasOwn(oBasePluginWrapper,key)||_hasOwn(Basket.prototype,key))return!1;pluginWrapper[oBasePluginWrapper.type]=oBasePluginWrapper,pluginWrapperDefinition[oBasePluginWrapper.type]={},Basket.prototype["I"+oBasePluginWrapper.type.toUpperCase()]=oBasePluginWrapper.type;for(key in oBasePluginWrapper)_hasOwn(oBasePluginWrapper,key)&&isFunction(oBasePluginWrapper[key])&&(pluginWrapperDefinition[oBasePluginWrapper.type][key]=oBasePluginWrapper[key]);return!0},objExports.unplug=function(oBasePluginWrapper,force){var name=oBasePluginWrapper.type;return delete pluginWrapper[name],delete pluginWrapperDefinition[name],delete Basket.prototype["I"+name.toUpperCase()],force&&delete Basket.prototype[oBasePluginWrapper.type],!0},objExports.getBasePluginWrapper=function(name){return new BasePluginWrapper(name,!1)},objExports.getBasePlugin=function(name){return new BasePluginWrapper(name,!0)},objExports});
