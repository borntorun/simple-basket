/*!
 * storage.js
 * storage plugin wrapper to use with
 * simplebasket (https://github.com/borntorun/simple-basket)
 * Copyright 2015 João Carvalho (https://github.com/borntorun); Licensed MIT
 */

/*!
 * localforageDriver.js
 * Driver for localforage (https://github.com/mozilla/localForage)
 * Supports all internal drivers in localforage plus:
 * - sessionStorageWrapper (https://github.com/thgreasi/localForage-sessionStorageWrapper)
 * Copyright 2015 João Carvalho (https://github.com/borntorun); Licensed MIT
 *
 * This package includes the following packages:
 * es6-promise (https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE)
 * localForage (https://github.com/mozilla/localForage/blob/master/LICENSE)
 * localForage-sessionStorageWrapper (https://github.com/thgreasi/localForage-sessionStorageWrapper/blob/master/LICENSE)
 */
(function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function lib$es6$promise$utils$$isFunction(x){return"function"==typeof x}function lib$es6$promise$utils$$isMaybeThenable(x){return"object"==typeof x&&null!==x}function lib$es6$promise$asap$$asap(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback,lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg,lib$es6$promise$asap$$len+=2,2===lib$es6$promise$asap$$len&&(lib$es6$promise$asap$$customSchedulerFn?lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush):lib$es6$promise$asap$$scheduleFlush())}function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$useNextTick(){var nextTick=process.nextTick,version=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(version)&&"0"===version[1]&&"10"===version[2]&&(nextTick=setImmediate),function(){nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0,observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=lib$es6$promise$asap$$flush,function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}function lib$es6$promise$asap$$flush(){for(var i=0;lib$es6$promise$asap$$len>i;i+=2){var callback=lib$es6$promise$asap$$queue[i],arg=lib$es6$promise$asap$$queue[i+1];callback(arg),lib$es6$promise$asap$$queue[i]=void 0,lib$es6$promise$asap$$queue[i+1]=void 0}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertex(){try{var r=require,vertx=r("vertx");return lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext,lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}function lib$es6$promise$$internal$$noop(){}function lib$es6$promise$$internal$$selfFullfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){return lib$es6$promise$$internal$$GET_THEN_ERROR.error=error,lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$default(function(promise){var sealed=!1,error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?lib$es6$promise$$internal$$resolve(promise,value):lib$es6$promise$$internal$$fulfill(promise,value))},function(reason){sealed||(sealed=!0,lib$es6$promise$$internal$$reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,lib$es6$promise$$internal$$reject(promise,error))},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){thenable._state===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,thenable._result):thenable._state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,thenable._result):lib$es6$promise$$internal$$subscribe(thenable,void 0,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor)lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable);else{var then=lib$es6$promise$$internal$$getThen(maybeThenable);then===lib$es6$promise$$internal$$GET_THEN_ERROR?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error):void 0===then?lib$es6$promise$$internal$$fulfill(promise,maybeThenable):lib$es6$promise$utils$$isFunction(then)?lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then):lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}function lib$es6$promise$$internal$$resolve(promise,value){promise===value?lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFullfillment()):lib$es6$promise$utils$$objectOrFunction(value)?lib$es6$promise$$internal$$handleMaybeThenable(promise,value):lib$es6$promise$$internal$$fulfill(promise,value)}function lib$es6$promise$$internal$$publishRejection(promise){promise._onerror&&promise._onerror(promise._result),lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._result=value,promise._state=lib$es6$promise$$internal$$FULFILLED,0!==promise._subscribers.length&&lib$es6$promise$asap$$default(lib$es6$promise$$internal$$publish,promise))}function lib$es6$promise$$internal$$reject(promise,reason){promise._state===lib$es6$promise$$internal$$PENDING&&(promise._state=lib$es6$promise$$internal$$REJECTED,promise._result=reason,lib$es6$promise$asap$$default(lib$es6$promise$$internal$$publishRejection,promise))}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers,length=subscribers.length;parent._onerror=null,subscribers[length]=child,subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment,subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection,0===length&&parent._state&&lib$es6$promise$asap$$default(lib$es6$promise$$internal$$publish,parent)}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child,callback,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){return lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e,lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var value,error,succeeded,failed,hasCallback=lib$es6$promise$utils$$isFunction(callback);if(hasCallback){if(value=lib$es6$promise$$internal$$tryCatch(callback,detail),value===lib$es6$promise$$internal$$TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==lib$es6$promise$$internal$$PENDING||(hasCallback&&succeeded?lib$es6$promise$$internal$$resolve(promise,value):failed?lib$es6$promise$$internal$$reject(promise,error):settled===lib$es6$promise$$internal$$FULFILLED?lib$es6$promise$$internal$$fulfill(promise,value):settled===lib$es6$promise$$internal$$REJECTED&&lib$es6$promise$$internal$$reject(promise,value))}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$enumerator$$Enumerator(Constructor,input){var enumerator=this;enumerator._instanceConstructor=Constructor,enumerator.promise=new Constructor(lib$es6$promise$$internal$$noop),enumerator._validateInput(input)?(enumerator._input=input,enumerator.length=input.length,enumerator._remaining=input.length,enumerator._init(),0===enumerator.length?lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result):(enumerator.length=enumerator.length||0,enumerator._enumerate(),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(enumerator.promise,enumerator._result))):lib$es6$promise$$internal$$reject(enumerator.promise,enumerator._validationError())}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}function lib$es6$promise$promise$race$$race(entries){function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries))return lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race.")),promise;for(var length=entries.length,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),void 0,onFulfillment,onRejection);return promise}function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$resolve(promise,object),promise}function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this,promise=new Constructor(lib$es6$promise$$internal$$noop);return lib$es6$promise$$internal$$reject(promise,reason),promise}function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++,this._state=void 0,this._result=void 0,this._subscribers=[],lib$es6$promise$$internal$$noop!==resolver&&(lib$es6$promise$utils$$isFunction(resolver)||lib$es6$promise$promise$$needsResolver(),this instanceof lib$es6$promise$promise$$Promise||lib$es6$promise$promise$$needsNew(),lib$es6$promise$$internal$$initializePromise(this,resolver))}function lib$es6$promise$polyfill$$polyfill(){var local;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;(!P||"[object Promise]"!==Object.prototype.toString.call(P.resolve())||P.cast)&&(local.Promise=lib$es6$promise$promise$$default)}var lib$es6$promise$utils$$_isArray;lib$es6$promise$utils$$_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var lib$es6$promise$asap$$vertxNext,lib$es6$promise$asap$$customSchedulerFn,lib$es6$promise$asap$$scheduleFlush,lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray,lib$es6$promise$asap$$len=0,lib$es6$promise$asap$$default=({}.toString,lib$es6$promise$asap$$asap),lib$es6$promise$asap$$browserWindow="undefined"!=typeof window?window:void 0,lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{},lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver,lib$es6$promise$asap$$isNode="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),lib$es6$promise$asap$$isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,lib$es6$promise$asap$$queue=new Array(1e3);lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$isNode?lib$es6$promise$asap$$useNextTick():lib$es6$promise$asap$$BrowserMutationObserver?lib$es6$promise$asap$$useMutationObserver():lib$es6$promise$asap$$isWorker?lib$es6$promise$asap$$useMessageChannel():void 0===lib$es6$promise$asap$$browserWindow&&"function"==typeof require?lib$es6$promise$asap$$attemptVertex():lib$es6$promise$asap$$useSetTimeout();var lib$es6$promise$$internal$$PENDING=void 0,lib$es6$promise$$internal$$FULFILLED=1,lib$es6$promise$$internal$$REJECTED=2,lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject,lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;lib$es6$promise$enumerator$$Enumerator.prototype._validateInput=function(input){return lib$es6$promise$utils$$isArray(input)},lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},lib$es6$promise$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){for(var enumerator=this,length=enumerator.length,promise=enumerator.promise,input=enumerator._input,i=0;promise._state===lib$es6$promise$$internal$$PENDING&&length>i;i++)enumerator._eachEntry(input[i],i)},lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var enumerator=this,c=enumerator._instanceConstructor;lib$es6$promise$utils$$isMaybeThenable(entry)?entry.constructor===c&&entry._state!==lib$es6$promise$$internal$$PENDING?(entry._onerror=null,enumerator._settledAt(entry._state,i,entry._result)):enumerator._willSettleAt(c.resolve(entry),i):(enumerator._remaining--,enumerator._result[i]=entry)},lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var enumerator=this,promise=enumerator.promise;promise._state===lib$es6$promise$$internal$$PENDING&&(enumerator._remaining--,state===lib$es6$promise$$internal$$REJECTED?lib$es6$promise$$internal$$reject(promise,value):enumerator._result[i]=value),0===enumerator._remaining&&lib$es6$promise$$internal$$fulfill(promise,enumerator._result)},lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,void 0,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all,lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race,lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve,lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject,lib$es6$promise$promise$$counter=0,lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default,lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default,lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default,lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default,lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler,lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$default,lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this,state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection)return this;var child=new this.constructor(lib$es6$promise$$internal$$noop),result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$default(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection);return child},"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill,lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};"function"==typeof define&&define.amd?define(function(){return lib$es6$promise$umd$$ES6Promise}):"undefined"!=typeof module&&module.exports?module.exports=lib$es6$promise$umd$$ES6Promise:"undefined"!=typeof this&&(this.ES6Promise=lib$es6$promise$umd$$ES6Promise),lib$es6$promise$polyfill$$default()}).call(this),function(){"use strict";function serialize(value,callback){var valueString="";if(value&&(valueString=value.toString()),value&&("[object ArrayBuffer]"===value.toString()||value.buffer&&"[object ArrayBuffer]"===value.buffer.toString())){var buffer,marker=SERIALIZED_MARKER;value instanceof ArrayBuffer?(buffer=value,marker+=TYPE_ARRAYBUFFER):(buffer=value.buffer,"[object Int8Array]"===valueString?marker+=TYPE_INT8ARRAY:"[object Uint8Array]"===valueString?marker+=TYPE_UINT8ARRAY:"[object Uint8ClampedArray]"===valueString?marker+=TYPE_UINT8CLAMPEDARRAY:"[object Int16Array]"===valueString?marker+=TYPE_INT16ARRAY:"[object Uint16Array]"===valueString?marker+=TYPE_UINT16ARRAY:"[object Int32Array]"===valueString?marker+=TYPE_INT32ARRAY:"[object Uint32Array]"===valueString?marker+=TYPE_UINT32ARRAY:"[object Float32Array]"===valueString?marker+=TYPE_FLOAT32ARRAY:"[object Float64Array]"===valueString?marker+=TYPE_FLOAT64ARRAY:callback(new Error("Failed to get type for BinaryArray"))),callback(marker+bufferToString(buffer))}else if("[object Blob]"===valueString){var fileReader=new FileReader;fileReader.onload=function(){var str=bufferToString(this.result);callback(SERIALIZED_MARKER+TYPE_BLOB+str)},fileReader.readAsArrayBuffer(value)}else try{callback(JSON.stringify(value))}catch(e){window.console.error("Couldn't convert value into a JSON string: ",value),callback(null,e)}}function deserialize(value){if(value.substring(0,SERIALIZED_MARKER_LENGTH)!==SERIALIZED_MARKER)return JSON.parse(value);var serializedString=value.substring(TYPE_SERIALIZED_MARKER_LENGTH),type=value.substring(SERIALIZED_MARKER_LENGTH,TYPE_SERIALIZED_MARKER_LENGTH),buffer=stringToBuffer(serializedString);switch(type){case TYPE_ARRAYBUFFER:return buffer;case TYPE_BLOB:return new Blob([buffer]);case TYPE_INT8ARRAY:return new Int8Array(buffer);case TYPE_UINT8ARRAY:return new Uint8Array(buffer);case TYPE_UINT8CLAMPEDARRAY:return new Uint8ClampedArray(buffer);case TYPE_INT16ARRAY:return new Int16Array(buffer);case TYPE_UINT16ARRAY:return new Uint16Array(buffer);case TYPE_INT32ARRAY:return new Int32Array(buffer);case TYPE_UINT32ARRAY:return new Uint32Array(buffer);case TYPE_FLOAT32ARRAY:return new Float32Array(buffer);case TYPE_FLOAT64ARRAY:return new Float64Array(buffer);default:throw new Error("Unkown type: "+type)}}function stringToBuffer(serializedString){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*serializedString.length,len=serializedString.length,p=0;"="===serializedString[serializedString.length-1]&&(bufferLength--,"="===serializedString[serializedString.length-2]&&bufferLength--);var buffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(buffer);for(i=0;len>i;i+=4)encoded1=BASE_CHARS.indexOf(serializedString[i]),encoded2=BASE_CHARS.indexOf(serializedString[i+1]),encoded3=BASE_CHARS.indexOf(serializedString[i+2]),encoded4=BASE_CHARS.indexOf(serializedString[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return buffer}function bufferToString(buffer){var i,bytes=new Uint8Array(buffer),base64String="";for(i=0;i<bytes.length;i+=3)base64String+=BASE_CHARS[bytes[i]>>2],base64String+=BASE_CHARS[(3&bytes[i])<<4|bytes[i+1]>>4],base64String+=BASE_CHARS[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64String+=BASE_CHARS[63&bytes[i+2]];return bytes.length%3===2?base64String=base64String.substring(0,base64String.length-1)+"=":bytes.length%3===1&&(base64String=base64String.substring(0,base64String.length-2)+"=="),base64String}var BASE_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",SERIALIZED_MARKER="__lfsc__:",SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER.length,TYPE_ARRAYBUFFER="arbf",TYPE_BLOB="blob",TYPE_INT8ARRAY="si08",TYPE_UINT8ARRAY="ui08",TYPE_UINT8CLAMPEDARRAY="uic8",TYPE_INT16ARRAY="si16",TYPE_INT32ARRAY="si32",TYPE_UINT16ARRAY="ur16",TYPE_UINT32ARRAY="ui32",TYPE_FLOAT32ARRAY="fl32",TYPE_FLOAT64ARRAY="fl64",TYPE_SERIALIZED_MARKER_LENGTH=SERIALIZED_MARKER_LENGTH+TYPE_ARRAYBUFFER.length,localforageSerializer={serialize:serialize,deserialize:deserialize,stringToBuffer:stringToBuffer,bufferToString:bufferToString};"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?module.exports=localforageSerializer:"function"==typeof define&&define.amd?define("localforageSerializer",function(){return localforageSerializer}):this.localforageSerializer=localforageSerializer}.call(window),function(){"use strict";function _initStorage(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]=options[i];return new Promise(function(resolve,reject){var openreq=indexedDB.open(dbInfo.name,dbInfo.version);openreq.onerror=function(){reject(openreq.error)},openreq.onupgradeneeded=function(){openreq.result.createObjectStore(dbInfo.storeName)},openreq.onsuccess=function(){dbInfo.db=openreq.result,self._dbInfo=dbInfo,resolve()}})}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.get(key);req.onsuccess=function(){var value=req.result;void 0===value&&(value=null),resolve(value)},req.onerror=function(){reject(req.error)}})["catch"](reject)});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.openCursor(),iterationNumber=1;req.onsuccess=function(){var cursor=req.result;if(cursor){var result=iterator(cursor.value,cursor.key,iterationNumber++);void 0!==result?resolve(result):cursor["continue"]()}else resolve()},req.onerror=function(){reject(req.error)}})["catch"](reject)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName);null===value&&(value=void 0);var req=store.put(value,key);transaction.oncomplete=function(){void 0===value&&(value=null),resolve(value)},transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)}})["catch"](reject)});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName),req=store["delete"](key);transaction.oncomplete=function(){resolve()},transaction.onerror=function(){reject(req.error)},transaction.onabort=function(){var err=req.error?req.error:req.transaction.error;reject(err)}})["catch"](reject)});return executeCallback(promise,callback),promise}function clear(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,transaction=dbInfo.db.transaction(dbInfo.storeName,"readwrite"),store=transaction.objectStore(dbInfo.storeName),req=store.clear();transaction.oncomplete=function(){resolve()},transaction.onabort=transaction.onerror=function(){var err=req.error?req.error:req.transaction.error;reject(err)}})["catch"](reject)});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.count();req.onsuccess=function(){resolve(req.result)},req.onerror=function(){reject(req.error)}})["catch"](reject)});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=new Promise(function(resolve,reject){return 0>n?void resolve(null):void self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),advanced=!1,req=store.openCursor();req.onsuccess=function(){var cursor=req.result;return cursor?void(0===n?resolve(cursor.key):advanced?resolve(cursor.key):(advanced=!0,cursor.advance(n))):void resolve(null)},req.onerror=function(){reject(req.error)}})["catch"](reject)});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo,store=dbInfo.db.transaction(dbInfo.storeName,"readonly").objectStore(dbInfo.storeName),req=store.openCursor(),keys=[];req.onsuccess=function(){var cursor=req.result;return cursor?(keys.push(cursor.key),void cursor["continue"]()):void resolve(keys)},req.onerror=function(){reject(req.error)}})["catch"](reject)});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?require("promise"):this.Promise,indexedDB=indexedDB||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(indexedDB){var asyncStorage={_driver:"asyncStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?module.exports=asyncStorage:"function"==typeof define&&define.amd?define("asyncStorage",function(){return asyncStorage}):this.asyncStorage=asyncStorage}}.call(window),function(){"use strict";function _initStorage(options){var self=this,dbInfo={};if(options)for(var i in options)dbInfo[i]=options[i];dbInfo.keyPrefix=dbInfo.name+"/",self._dbInfo=dbInfo;var serializerPromise=new Promise(function(resolve){moduleType===ModuleType.DEFINE?require(["localforageSerializer"],resolve):resolve(moduleType===ModuleType.EXPORT?require("./../utils/serializer"):globalObject.localforageSerializer)});return serializerPromise.then(function(lib){return serializer=lib,Promise.resolve()})}function clear(callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var key=localStorage.key(i);0===key.indexOf(keyPrefix)&&localStorage.removeItem(key)}});return executeCallback(promise,callback),promise}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo,result=localStorage.getItem(dbInfo.keyPrefix+key);return result&&(result=serializer.deserialize(result)),result});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,keyPrefixLength=keyPrefix.length,length=localStorage.length,i=0;length>i;i++){var key=localStorage.key(i),value=localStorage.getItem(key);if(value&&(value=serializer.deserialize(value)),value=iterator(value,key.substring(keyPrefixLength),i+1),void 0!==value)return value}});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=self.ready().then(function(){var result,dbInfo=self._dbInfo;try{result=localStorage.key(n)}catch(error){result=null}return result&&(result=result.substring(dbInfo.keyPrefix.length)),result});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=self.ready().then(function(){for(var dbInfo=self._dbInfo,length=localStorage.length,keys=[],i=0;length>i;i++)0===localStorage.key(i).indexOf(dbInfo.keyPrefix)&&keys.push(localStorage.key(i).substring(dbInfo.keyPrefix.length));return keys});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=self.keys().then(function(keys){return keys.length});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo;localStorage.removeItem(dbInfo.keyPrefix+key)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;return new Promise(function(resolve,reject){serializer.serialize(value,function(value,error){if(error)reject(error);else try{var dbInfo=self._dbInfo;localStorage.setItem(dbInfo.keyPrefix+key,value),resolve(originalValue)}catch(e){("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&reject(e),reject(e)}})})});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?require("promise"):this.Promise,globalObject=this,serializer=null,localStorage=null;try{if(!(this.localStorage&&"setItem"in this.localStorage))return;localStorage=this.localStorage}catch(e){return}var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var localStorageWrapper={_driver:"localStorageWrapper",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};moduleType===ModuleType.EXPORT?module.exports=localStorageWrapper:moduleType===ModuleType.DEFINE?define("localStorageWrapper",function(){return localStorageWrapper}):this.localStorageWrapper=localStorageWrapper}.call(window),function(){"use strict";function _initStorage(options){var self=this,dbInfo={db:null};if(options)for(var i in options)dbInfo[i]="string"!=typeof options[i]?options[i].toString():options[i];var serializerPromise=new Promise(function(resolve){moduleType===ModuleType.DEFINE?require(["localforageSerializer"],resolve):resolve(moduleType===ModuleType.EXPORT?require("./../utils/serializer"):globalObject.localforageSerializer)}),dbInfoPromise=new Promise(function(resolve,reject){try{dbInfo.db=openDatabase(dbInfo.name,String(dbInfo.version),dbInfo.description,dbInfo.size);
}catch(e){return self.setDriver(self.LOCALSTORAGE).then(function(){return self._initStorage(options)}).then(resolve)["catch"](reject)}dbInfo.db.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS "+dbInfo.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){self._dbInfo=dbInfo,resolve()},function(t,error){reject(error)})})});return serializerPromise.then(function(lib){return serializer=lib,dbInfoPromise})}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName+" WHERE key = ? LIMIT 1",[key],function(t,results){var result=results.rows.length?results.rows.item(0).value:null;result&&(result=serializer.deserialize(result)),resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT * FROM "+dbInfo.storeName,[],function(t,results){for(var rows=results.rows,length=rows.length,i=0;length>i;i++){var item=rows.item(i),result=item.value;if(result&&(result=serializer.deserialize(result)),result=iterator(result,item.key,i+1),void 0!==result)return void resolve(result)}resolve()},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;serializer.serialize(value,function(value,error){if(error)reject(error);else{var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("INSERT OR REPLACE INTO "+dbInfo.storeName+" (key, value) VALUES (?, ?)",[key,value],function(){resolve(originalValue)},function(t,error){reject(error)})},function(sqlError){sqlError.code===sqlError.QUOTA_ERR&&reject(sqlError)})}})})["catch"](reject)});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName+" WHERE key = ?",[key],function(){resolve()},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function clear(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("DELETE FROM "+dbInfo.storeName,[],function(){resolve()},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+dbInfo.storeName,[],function(t,results){var result=results.rows.item(0).c;resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName+" WHERE id = ? LIMIT 1",[n+1],function(t,results){var result=results.rows.length?results.rows.item(0).key:null;resolve(result)},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=new Promise(function(resolve,reject){self.ready().then(function(){var dbInfo=self._dbInfo;dbInfo.db.transaction(function(t){t.executeSql("SELECT key FROM "+dbInfo.storeName,[],function(t,results){for(var keys=[],i=0;i<results.rows.length;i++)keys.push(results.rows.item(i).key);resolve(keys)},function(t,error){reject(error)})})})["catch"](reject)});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?require("promise"):this.Promise,globalObject=this,serializer=null,openDatabase=this.openDatabase;if(openDatabase){var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var webSQLStorage={_driver:"webSQLStorage",_initStorage:_initStorage,iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};moduleType===ModuleType.DEFINE?define("webSQLStorage",function(){return webSQLStorage}):moduleType===ModuleType.EXPORT?module.exports=webSQLStorage:this.webSQLStorage=webSQLStorage}}.call(window),function(){"use strict";function callWhenReady(localForageInstance,libraryMethod){localForageInstance[libraryMethod]=function(){var _args=arguments;return localForageInstance.ready().then(function(){return localForageInstance[libraryMethod].apply(localForageInstance,_args)})}}function extend(){for(var i=1;i<arguments.length;i++){var arg=arguments[i];if(arg)for(var key in arg)arg.hasOwnProperty(key)&&(isArray(arg[key])?arguments[0][key]=arg[key].slice():arguments[0][key]=arg[key])}return arguments[0]}function isLibraryDriver(driverName){for(var driver in DriverType)if(DriverType.hasOwnProperty(driver)&&DriverType[driver]===driverName)return!0;return!1}function LocalForage(options){this._config=extend({},DefaultConfig,options),this._driverSet=null,this._ready=!1,this._dbInfo=null;for(var i=0;i<LibraryMethods.length;i++)callWhenReady(this,LibraryMethods[i]);this.setDriver(this._config.driver)}var Promise="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?require("promise"):this.Promise,CustomDrivers={},DriverType={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},DefaultDriverOrder=[DriverType.INDEXEDDB,DriverType.WEBSQL,DriverType.LOCALSTORAGE],LibraryMethods=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},DefaultConfig={description:"",driver:DefaultDriverOrder.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},moduleType=ModuleType.WINDOW;"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require?moduleType=ModuleType.EXPORT:"function"==typeof define&&define.amd&&(moduleType=ModuleType.DEFINE);var driverSupport=function(self){var indexedDB=indexedDB||self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.OIndexedDB||self.msIndexedDB,result={};return result[DriverType.WEBSQL]=!!self.openDatabase,result[DriverType.INDEXEDDB]=!!function(){if("undefined"!=typeof self.openDatabase&&self.navigator&&self.navigator.userAgent&&/Safari/.test(self.navigator.userAgent)&&!/Chrome/.test(self.navigator.userAgent))return!1;try{return indexedDB&&"function"==typeof indexedDB.open&&"undefined"!=typeof self.IDBKeyRange}catch(e){return!1}}(),result[DriverType.LOCALSTORAGE]=!!function(){try{return self.localStorage&&"setItem"in self.localStorage&&self.localStorage.setItem}catch(e){return!1}}(),result}(this),isArray=Array.isArray||function(arg){return"[object Array]"===Object.prototype.toString.call(arg)},globalObject=this;LocalForage.prototype.INDEXEDDB=DriverType.INDEXEDDB,LocalForage.prototype.LOCALSTORAGE=DriverType.LOCALSTORAGE,LocalForage.prototype.WEBSQL=DriverType.WEBSQL,LocalForage.prototype.config=function(options){if("object"==typeof options){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var i in options)"storeName"===i&&(options[i]=options[i].replace(/\W/g,"_")),this._config[i]=options[i];return"driver"in options&&options.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof options?this._config[options]:this._config},LocalForage.prototype.defineDriver=function(driverObject,callback,errorCallback){var defineDriver=new Promise(function(resolve,reject){try{var driverName=driverObject._driver,complianceError=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),namingError=new Error("Custom driver name already in use: "+driverObject._driver);if(!driverObject._driver)return void reject(complianceError);if(isLibraryDriver(driverObject._driver))return void reject(namingError);for(var customDriverMethods=LibraryMethods.concat("_initStorage"),i=0;i<customDriverMethods.length;i++){var customDriverMethod=customDriverMethods[i];if(!customDriverMethod||!driverObject[customDriverMethod]||"function"!=typeof driverObject[customDriverMethod])return void reject(complianceError)}var supportPromise=Promise.resolve(!0);"_support"in driverObject&&(supportPromise=driverObject._support&&"function"==typeof driverObject._support?driverObject._support():Promise.resolve(!!driverObject._support)),supportPromise.then(function(supportResult){driverSupport[driverName]=supportResult,CustomDrivers[driverName]=driverObject,resolve()},reject)}catch(e){reject(e)}});return defineDriver.then(callback,errorCallback),defineDriver},LocalForage.prototype.driver=function(){return this._driver||null},LocalForage.prototype.ready=function(callback){var self=this,ready=new Promise(function(resolve,reject){self._driverSet.then(function(){null===self._ready&&(self._ready=self._initStorage(self._config)),self._ready.then(resolve,reject)})["catch"](reject)});return ready.then(callback,callback),ready},LocalForage.prototype.setDriver=function(drivers,callback,errorCallback){function setDriverToConfig(){self._config.driver=self.driver()}var self=this;return"string"==typeof drivers&&(drivers=[drivers]),this._driverSet=new Promise(function(resolve,reject){var driverName=self._getFirstSupportedDriver(drivers),error=new Error("No available storage method found.");if(!driverName)return self._driverSet=Promise.reject(error),void reject(error);if(self._dbInfo=null,self._ready=null,isLibraryDriver(driverName)){var driverPromise=new Promise(function(resolve){if(moduleType===ModuleType.DEFINE)require([driverName],resolve);else if(moduleType===ModuleType.EXPORT)switch(driverName){case self.INDEXEDDB:resolve(require("./drivers/indexeddb"));break;case self.LOCALSTORAGE:resolve(require("./drivers/localstorage"));break;case self.WEBSQL:resolve(require("./drivers/websql"))}else resolve(globalObject[driverName])});driverPromise.then(function(driver){self._extend(driver),resolve()})}else CustomDrivers[driverName]?(self._extend(CustomDrivers[driverName]),resolve()):(self._driverSet=Promise.reject(error),reject(error))}),this._driverSet.then(setDriverToConfig,setDriverToConfig),this._driverSet.then(callback,errorCallback),this._driverSet},LocalForage.prototype.supports=function(driverName){return!!driverSupport[driverName]},LocalForage.prototype._extend=function(libraryMethodsAndProperties){extend(this,libraryMethodsAndProperties)},LocalForage.prototype._getFirstSupportedDriver=function(drivers){if(drivers&&isArray(drivers))for(var i=0;i<drivers.length;i++){var driver=drivers[i];if(this.supports(driver))return driver}return null},LocalForage.prototype.createInstance=function(options){return new LocalForage(options)};var localForage=new LocalForage;moduleType===ModuleType.DEFINE?define("localforage",function(){return localForage}):moduleType===ModuleType.EXPORT?module.exports=localForage:this.localforage=localForage}.call(window),function(){"use strict";function getSupport(){try{if(globalObject.sessionStorage&&"setItem"in globalObject.sessionStorage)return!0}catch(e){}return!1}function _initStorage(options){var self=this,dbInfo={};if(options)for(var i in options)dbInfo[i]=options[i];dbInfo.keyPrefix=dbInfo.name+"/",self._dbInfo=dbInfo;var serializerPromise=new Promise(function(resolve){moduleType===ModuleType.DEFINE?require(["localforageSerializer"],resolve):resolve(moduleType===ModuleType.EXPORT?require("./../utils/serializer"):globalObject.localforageSerializer)});return serializerPromise.then(function(lib){return serializer=lib,Promise.resolve()})}function clear(callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,i=sessionStorage.length-1;i>=0;i--){var key=sessionStorage.key(i);0===key.indexOf(keyPrefix)&&sessionStorage.removeItem(key)}});return executeCallback(promise,callback),promise}function getItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo,result=sessionStorage.getItem(dbInfo.keyPrefix+key);return result&&(result=serializer.deserialize(result)),result});return executeCallback(promise,callback),promise}function iterate(iterator,callback){var self=this,promise=self.ready().then(function(){for(var keyPrefix=self._dbInfo.keyPrefix,keyPrefixLength=keyPrefix.length,length=sessionStorage.length,i=0;length>i;i++){var key=sessionStorage.key(i),value=sessionStorage.getItem(key);if(value&&(value=serializer.deserialize(value)),value=iterator(value,key.substring(keyPrefixLength),i+1),void 0!==value)return value}});return executeCallback(promise,callback),promise}function key(n,callback){var self=this,promise=self.ready().then(function(){var result,dbInfo=self._dbInfo;try{result=sessionStorage.key(n)}catch(error){result=null}return result&&(result=result.substring(dbInfo.keyPrefix.length)),result});return executeCallback(promise,callback),promise}function keys(callback){var self=this,promise=self.ready().then(function(){for(var dbInfo=self._dbInfo,length=sessionStorage.length,keys=[],i=0;length>i;i++)0===sessionStorage.key(i).indexOf(dbInfo.keyPrefix)&&keys.push(sessionStorage.key(i).substring(dbInfo.keyPrefix.length));return keys});return executeCallback(promise,callback),promise}function length(callback){var self=this,promise=self.keys().then(function(keys){return keys.length});return executeCallback(promise,callback),promise}function removeItem(key,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){var dbInfo=self._dbInfo;sessionStorage.removeItem(dbInfo.keyPrefix+key)});return executeCallback(promise,callback),promise}function setItem(key,value,callback){var self=this;"string"!=typeof key&&(window.console.warn(key+" used as a key, but it is not a string."),key=String(key));var promise=self.ready().then(function(){void 0===value&&(value=null);var originalValue=value;return new Promise(function(resolve,reject){serializer.serialize(value,function(value,error){if(error)reject(error);else try{var dbInfo=self._dbInfo;sessionStorage.setItem(dbInfo.keyPrefix+key,value),resolve(originalValue)}catch(e){("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&reject(e),reject(e)}})})});return executeCallback(promise,callback),promise}function executeCallback(promise,callback){callback&&promise.then(function(result){callback(null,result)},function(error){callback(error)})}var Promise="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,globalObject=this,serializer=null,sessionStorage=null;if(getSupport()){sessionStorage=this.sessionStorage;var ModuleType={DEFINE:1,EXPORT:2,WINDOW:3},moduleType=ModuleType.WINDOW;"function"==typeof define&&define.amd?moduleType=ModuleType.DEFINE:"undefined"!=typeof module&&module.exports&&(moduleType=ModuleType.EXPORT);var sessionStorageWrapper={_driver:"sessionStorageWrapper",_initStorage:_initStorage,_support:function(){return new Promise(function(resolve){resolve(getSupport())})},iterate:iterate,getItem:getItem,setItem:setItem,removeItem:removeItem,clear:clear,length:length,key:key,keys:keys};moduleType===ModuleType.DEFINE?define("sessionStorageWrapper",function(){return sessionStorageWrapper}):moduleType===ModuleType.EXPORT?module.exports=sessionStorageWrapper:this.sessionStorageWrapper=sessionStorageWrapper}}.call(window),function(global,factory){"use strict";"function"==typeof define&&define.amd?define(["simplebasket"],function(simplebasket){return factory(simplebasket)}):"object"==typeof exports?module.exports=factory(require("simplebasket")):factory(global.simplebasket)}(this,function(simplebasket){"use strict";function callCallback(promise,callback){callback&&promise.then(function(data){callback(null,data)},function(err){callback(err)})}if(simplebasket&&simplebasket.plug){var iObj=simplebasket.getBasePluginWrapper("storage");return iObj.save=function(callback){return this[iObj.type].save(this.getClone(),callback)},iObj.load=function(callback){var self=this,thePromise=new Promise(function(resolve,reject){self[iObj.type].load().then(function(data){self.removeAll(),!!data&&self.add(data),resolve(self.getClone())})["catch"](function(error){reject(error)})});return callCallback(thePromise,callback),thePromise},iObj.clear=function(callback){return this[iObj.type].clear(callback)},simplebasket.plug(iObj),simplebasket}}),function(global,factory){"use strict";"function"==typeof define&&define.amd?define(["localforage","sessionStorageWrapper"],function(localforage,sessionStorageWrapper){factory(localforage,sessionStorageWrapper)}):"object"==typeof exports?module.exports=factory(require("localforage"),require("sessionStorageWrapper")):global.localforageDriver=factory(global.localforage,global.sessionStorageWrapper)}(this,function(localforage,sessionStorageWrapper){"use strict";function LocalforageDriverFactory(){function create(wrapperStorage,opt){var driver=new LocalforageDriver;return wrapperStorage?driver.config(wrapperStorage,opt):new Promise(function(resolve){resolve(driver)})}this.create=create}function LocalforageDriver(){function config(wrapperStorage,opt){function setOption(key,type,defaultValue){typeof opt[key]===type?options[key]=opt[key]:void 0!==defaultValue&&(options[key]=defaultValue)}var wrapper=STORAGEWRAPPERS[wrapperStorage],thePromise=new Promise(function(resolve,reject){function setDriver(driver){localForageInstance.setDriver(driver).then(function(){options.driver=wrapper.name,configOk=!0,resolve(_thislocalforageDriver)})["catch"](function(error){reject(error)})}if(configCalled)return void reject(ERRORS.CONFIGALREADYCALLED);if(!wrapper)return void reject(ERRORS.DRIVERINVALID.replace("#",wrapperStorage));if(configCalled=!0,opt=isHashObject(opt)?opt:{},setOption("name","string","app-localforageDriver"),setOption("storeName","string","store"),setOption("description","string",""),setOption("size","number"),setOption("key","string","key"),Object.keys(options).length>0&&localForageInstance.config(options),hasProp(wrapper,"driver")){if(!wrapper.driver)return void reject(ERRORS.DRIVERNOTDEFINED.replace("#",wrapper.name));localForageInstance.defineDriver(wrapper.driver).then(function(){setDriver(wrapper.name)})["catch"](function(error){reject(error)})}else setDriver(wrapper.name)});return thePromise}function load(callback){var thePromise=new Promise(function(resolve,reject){return configOk?void localForageInstance.ready().then(function(){return localForageInstance.getItem(options.key)}).then(function(data){resolve(data)})["catch"](function(error){reject(error)}):void reject(ERRORS.INVALIDSTATE)});return callCallback(thePromise,callback),thePromise}function save(value,callback){var thePromise=new Promise(function(resolve,reject){return configOk?void localForageInstance.ready().then(function(){return localForageInstance.setItem(options.key,value)}).then(function(data){resolve(data)})["catch"](function(error){reject(error)}):void reject(ERRORS.INVALIDSTATE)});return callCallback(thePromise,callback),thePromise}function clear(callback){var thePromise=new Promise(function(resolve,reject){return configOk?void localForageInstance.ready().then(function(){return localForageInstance.removeItem(options.key)}).then(function(data){resolve(data)})["catch"](function(error){reject(error)}):void reject(ERRORS.INVALIDSTATE)});return callCallback(thePromise,callback),thePromise}function callCallback(promise,callback){callback&&promise.then(function(data){callback(null,data)},function(err){callback(err)})}function hasProp(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}function isHashObject(obj){return!!obj&&"object"==typeof obj&&(void 0===obj.constructor||obj.constructor==={}.constructor)}var localForageInstance,configOk=!1,configCalled=!1,options={},_thislocalforageDriver=this;localForageInstance=localforage.createInstance(),this.name="localforageDriver",this.config=config,this.load=load,this.save=save,this.clear=clear,this.getOptions=function(){return options}}var STORAGEWRAPPERS={localstorage:{name:localforage.LOCALSTORAGE},indexeddb:{name:localforage.INDEXEDDB},websql:{name:localforage.WEBSQL},sessionstorage:{name:"sessionStorageWrapper",driver:sessionStorageWrapper}},ERRORS={INVALIDSTATE:new Error("Storage driver config is in invalid state."),CONFIGALREADYCALLED:new Error("Config already called."),DRIVERINVALID:new Error("Driver is invalid.[#]"),DRIVERNOTDEFINED:new Error("Driver is not defined.[#]")};return LocalforageDriverFactory.prototype.STORAGE={LOCALSTORAGE:"localstorage",SESSIONSTORAGE:"sessionstorage",INDEXEDDB:"indexeddb",WEBSQL:"websql"},new LocalforageDriverFactory});
