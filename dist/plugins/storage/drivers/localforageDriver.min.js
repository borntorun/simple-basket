/*!
 * localforageDriver.js
 * Driver for localforage (https://github.com/mozilla/localForage)
 * Supports all internal drivers in localforage plus:
 * - sessionStorageWrapper (https://github.com/thgreasi/localForage-sessionStorageWrapper)
 * Copyright 2016 JoÃ£o Carvalho (https://github.com/borntorun); Licensed MIT
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["localforage","sessionStorageWrapper"],function(a,c){b(a,c)}):"object"==typeof exports?module.exports=b(require("localforage"),require("sessionStorageWrapper")):a.localforageDriver=b(a.localforage,a.sessionStorageWrapper)}(this,function(a,b){"use strict";function c(){function a(a,b){var c=new d;return a?c.config(a,b):new Promise(function(a){a(c)})}this.create=a}function d(){function b(a,b){function c(a,c,d){typeof b[a]===c?o[a]=b[a]:void 0!==d&&(o[a]=d)}var d=e[a],g=new Promise(function(e,g){function h(a){l.setDriver(a).then(function(){o.driver=d.name,m=!0,e(p)})["catch"](function(a){g(a)})}if(n)return void g(f.CONFIGALREADYCALLED);if(!d)return void g(f.DRIVERINVALID.replace("#",a));if(n=!0,b=j(b)?b:{},c("name","string","app-localforageDriver"),c("storeName","string","store"),c("description","string",""),c("size","number"),c("key","string","key"),Object.keys(o).length>0&&l.config(o),i(d,"driver")){if(!d.driver)return void g(f.DRIVERNOTDEFINED.replace("#",d.name));l.defineDriver(d.driver).then(function(){h(d.name)})["catch"](function(a){g(a)})}else h(d.name)});return g}function c(a){var b=new Promise(function(a,b){return m?void l.ready().then(function(){return l.getItem(o.key)}).then(function(b){a(b)})["catch"](function(a){b(a)}):void b(f.INVALIDSTATE)});return h(b,a),b}function d(a,b){var c=new Promise(function(b,c){return m?void l.ready().then(function(){return l.setItem(o.key,a)}).then(function(a){b(a)})["catch"](function(a){c(a)}):void c(f.INVALIDSTATE)});return h(c,b),c}function g(a){var b=new Promise(function(a,b){return m?void l.ready().then(function(){return l.removeItem(o.key)}).then(function(b){a(b)})["catch"](function(a){b(a)}):void b(f.INVALIDSTATE)});return h(b,a),b}function h(a,b){k(b)&&a.then(function(a){b(null,a)},function(a){b(a)})}function i(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function j(a){return!!a&&"object"==typeof a&&(void 0===a.constructor||a.constructor==={}.constructor)}function k(a){return"[object Function]"==={}.toString.call(a)}var l,m=!1,n=!1,o={},p=this;l=a.createInstance(),this.name="localforageDriver",this.config=b,this.load=c,this.save=d,this.clear=g,this.getOptions=function(){return o}}var e={localstorage:{name:a.LOCALSTORAGE},indexeddb:{name:a.INDEXEDDB},websql:{name:a.WEBSQL},sessionstorage:{name:"sessionStorageWrapper",driver:b}},f={INVALIDSTATE:new Error("Storage driver config is in invalid state."),CONFIGALREADYCALLED:new Error("Config already called."),DRIVERINVALID:new Error("Driver is invalid.[#]"),DRIVERNOTDEFINED:new Error("Driver is not defined.[#]")};return c.prototype.STORAGE={LOCALSTORAGE:"localstorage",SESSIONSTORAGE:"sessionstorage",INDEXEDDB:"indexeddb",WEBSQL:"websql"},new c});
