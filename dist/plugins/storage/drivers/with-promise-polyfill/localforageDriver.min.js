/*!
 * localforageDriver.js
 * Driver for localforage (https://github.com/mozilla/localForage)
 * Supports all internal drivers in localforage plus:
 * - sessionStorageWrapper (https://github.com/thgreasi/localForage-sessionStorageWrapper)
 * Copyright 2015 JoÃ£o Carvalho (https://github.com/borntorun); Licensed MIT
 */
/*
 * This package includes the following packages:
 */
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   2.3.0
 */
(function(){"use strict";function a(a){return"function"==typeof a||"object"==typeof a&&null!==a}function b(a){return"function"==typeof a}function c(a){return"object"==typeof a&&null!==a}function d(a,b){Z[S]=a,Z[S+1]=b,S+=2,2===S&&(P?P(k):Q())}function e(a){P=a}function f(){var a=process.nextTick,b=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(b)&&"0"===b[1]&&"10"===b[2]&&(a=setImmediate),function(){a(k)}}function g(){return function(){O(k)}}function h(){var a=0,b=new W(k),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function i(){var a=new MessageChannel;return a.port1.onmessage=k,function(){a.port2.postMessage(0)}}function j(){return function(){setTimeout(k,1)}}function k(){for(var a=0;S>a;a+=2){var b=Z[a],c=Z[a+1];b(c),Z[a]=void 0,Z[a+1]=void 0}S=0}function l(){try{var a=require,b=a("vertx");return O=b.runOnLoop||b.runOnContext,g()}catch(c){return j()}}function m(){}function n(){return new TypeError("You cannot resolve a promise with itself")}function o(){return new TypeError("A promises callback cannot return that same promise.")}function p(a){try{return a.then}catch(b){return ba.error=b,ba}}function q(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function r(a,b,c){T(function(a){var d=!1,e=q(c,b,function(c){d||(d=!0,b!==c?u(a,c):w(a,c))},function(b){d||(d=!0,x(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,x(a,e))},a)}function s(a,b){b._state===_?w(a,b._result):b._state===aa?x(a,b._result):y(b,void 0,function(b){u(a,b)},function(b){x(a,b)})}function t(a,c){if(c.constructor===a.constructor)s(a,c);else{var d=p(c);d===ba?x(a,ba.error):void 0===d?w(a,c):b(d)?r(a,c,d):w(a,c)}}function u(b,c){b===c?x(b,n()):a(c)?t(b,c):w(b,c)}function v(a){a._onerror&&a._onerror(a._result),z(a)}function w(a,b){a._state===$&&(a._result=b,a._state=_,0!==a._subscribers.length&&T(z,a))}function x(a,b){a._state===$&&(a._state=aa,a._result=b,T(v,a))}function y(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+_]=c,e[f+aa]=d,0===f&&a._state&&T(z,a)}function z(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?C(c,d,e,f):e(f);a._subscribers.length=0}}function A(){this.error=null}function B(a,b){try{return a(b)}catch(c){return ca.error=c,ca}}function C(a,c,d,e){var f,g,h,i,j=b(d);if(j){if(f=B(d,e),f===ca?(i=!0,g=f.error,f=null):h=!0,c===f)return void x(c,o())}else f=e,h=!0;c._state!==$||(j&&h?u(c,f):i?x(c,g):a===_?w(c,f):a===aa&&x(c,f))}function D(a,b){try{b(function(b){u(a,b)},function(b){x(a,b)})}catch(c){x(a,c)}}function E(a,b){var c=this;c._instanceConstructor=a,c.promise=new a(m),c._validateInput(b)?(c._input=b,c.length=b.length,c._remaining=b.length,c._init(),0===c.length?w(c.promise,c._result):(c.length=c.length||0,c._enumerate(),0===c._remaining&&w(c.promise,c._result))):x(c.promise,c._validationError())}function F(a){return new da(this,a).promise}function G(a){function b(a){u(e,a)}function c(a){x(e,a)}var d=this,e=new d(m);if(!R(a))return x(e,new TypeError("You must pass an array to race.")),e;for(var f=a.length,g=0;e._state===$&&f>g;g++)y(d.resolve(a[g]),void 0,b,c);return e}function H(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(m);return u(c,a),c}function I(a){var b=this,c=new b(m);return x(c,a),c}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function K(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(a){this._id=ia++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==a&&(b(a)||J(),this instanceof L||K(),D(this,a))}function M(){var a;if("undefined"!=typeof global)a=global;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(b){throw new Error("polyfill failed because global object is unavailable in this environment")}var c=a.Promise;(!c||"[object Promise]"!==Object.prototype.toString.call(c.resolve())||c.cast)&&(a.Promise=ja)}var N;N=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var O,P,Q,R=N,S=0,T=({}.toString,d),U="undefined"!=typeof window?window:void 0,V=U||{},W=V.MutationObserver||V.WebKitMutationObserver,X="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Y="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3);Q=X?f():W?h():Y?i():void 0===U&&"function"==typeof require?l():j();var $=void 0,_=1,aa=2,ba=new A,ca=new A;E.prototype._validateInput=function(a){return R(a)},E.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},E.prototype._init=function(){this._result=new Array(this.length)};var da=E;E.prototype._enumerate=function(){for(var a=this,b=a.length,c=a.promise,d=a._input,e=0;c._state===$&&b>e;e++)a._eachEntry(d[e],e)},E.prototype._eachEntry=function(a,b){var d=this,e=d._instanceConstructor;c(a)?a.constructor===e&&a._state!==$?(a._onerror=null,d._settledAt(a._state,b,a._result)):d._willSettleAt(e.resolve(a),b):(d._remaining--,d._result[b]=a)},E.prototype._settledAt=function(a,b,c){var d=this,e=d.promise;e._state===$&&(d._remaining--,a===aa?x(e,c):d._result[b]=c),0===d._remaining&&w(e,d._result)},E.prototype._willSettleAt=function(a,b){var c=this;y(a,void 0,function(a){c._settledAt(_,b,a)},function(a){c._settledAt(aa,b,a)})};var ea=F,fa=G,ga=H,ha=I,ia=0,ja=L;L.all=ea,L.race=fa,L.resolve=ga,L.reject=ha,L._setScheduler=e,L._asap=T,L.prototype={constructor:L,then:function(a,b){var c=this,d=c._state;if(d===_&&!a||d===aa&&!b)return this;var e=new this.constructor(m),f=c._result;if(d){var g=arguments[d-1];T(function(){C(d,e,g,f)})}else y(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var ka=M,la={Promise:ja,polyfill:ka};"function"==typeof define&&define.amd?define(function(){return la}):"undefined"!=typeof module&&module.exports?module.exports=la:"undefined"!=typeof this&&(this.ES6Promise=la),ka()}).call(this),function(a,b){"use strict";"function"==typeof define&&define.amd?define(["localforage","sessionStorageWrapper"],function(a,c){b(a,c)}):"object"==typeof exports?module.exports=b(require("localforage"),require("sessionStorageWrapper")):a.localforageDriver=b(a.localforage,a.sessionStorageWrapper)}(this,function(a,b){"use strict";function c(){function a(a,b){var c=new d;return a?c.config(a,b):new Promise(function(a){a(c)})}this.create=a}function d(){function b(a,b){function c(a,c,d){typeof b[a]===c?n[a]=b[a]:void 0!==d&&(n[a]=d)}var d=e[a],g=new Promise(function(e,g){function h(a){k.setDriver(a).then(function(){n.driver=d.name,l=!0,e(o)})["catch"](function(a){g(a)})}if(m)return void g(f.CONFIGALREADYCALLED);if(!d)return void g(f.DRIVERINVALID.replace("#",a));if(m=!0,b=j(b)?b:{},c("name","string","app-localforageDriver"),c("storeName","string","store"),c("description","string",""),c("size","number"),c("key","string","key"),Object.keys(n).length>0&&k.config(n),i(d,"driver")){if(!d.driver)return void g(f.DRIVERNOTDEFINED.replace("#",d.name));k.defineDriver(d.driver).then(function(){h(d.name)})["catch"](function(a){g(a)})}else h(d.name)});return g}function c(a){var b=new Promise(function(a,b){return l?void k.ready().then(function(){return k.getItem(n.key)}).then(function(b){a(b)})["catch"](function(a){b(a)}):void b(f.INVALIDSTATE)});return h(b,a),b}function d(a,b){var c=new Promise(function(b,c){return l?void k.ready().then(function(){return k.setItem(n.key,a)}).then(function(a){b(a)})["catch"](function(a){c(a)}):void c(f.INVALIDSTATE)});return h(c,b),c}function g(a){var b=new Promise(function(a,b){return l?void k.ready().then(function(){return k.removeItem(n.key)}).then(function(b){a(b)})["catch"](function(a){b(a)}):void b(f.INVALIDSTATE)});return h(b,a),b}function h(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}function i(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function j(a){return!!a&&"object"==typeof a&&(void 0===a.constructor||a.constructor==={}.constructor)}var k,l=!1,m=!1,n={},o=this;k=a.createInstance(),this.name="localforageDriver",this.config=b,this.load=c,this.save=d,this.clear=g,this.getOptions=function(){return n}}var e={localstorage:{name:a.LOCALSTORAGE},indexeddb:{name:a.INDEXEDDB},websql:{name:a.WEBSQL},sessionstorage:{name:"sessionStorageWrapper",driver:b}},f={INVALIDSTATE:new Error("Storage driver config is in invalid state."),CONFIGALREADYCALLED:new Error("Config already called."),DRIVERINVALID:new Error("Driver is invalid.[#]"),DRIVERNOTDEFINED:new Error("Driver is not defined.[#]")};return c.prototype.STORAGE={LOCALSTORAGE:"localstorage",SESSIONSTORAGE:"sessionstorage",INDEXEDDB:"indexeddb",WEBSQL:"websql"},new c});
